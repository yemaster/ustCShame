<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ustCShame</title>
  
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css">
  
  <style>
    /* =========================================
       CSS å˜é‡ (æ·±è‰²/æµ…è‰²æ¨¡å¼)
       ========================================= */
    :root {
      --primary-color: #0366d6;
      --bg-color: #f6f8fa;
      --card-bg: #ffffff;
      --text-primary: #24292e;
      --text-secondary: #586069;
      --border-color: #e1e4e8;
      --header-bg: #fcfcfc;
      --hover-bg: #f6f8fa;
      --item-hover-bg: #f1f8ff;
      --btn-bg: #fafbfc;
      --btn-border: #1b1f2326;
      --btn-hover-bg: #f3f4f6;
      --code-bg: #f6f8fa;
      --back-item-bg: #fff9f9;
      --separator-color: #999;
      --shadow-color: rgba(0,0,0,0.05);
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --primary-color: #58a6ff;
        --bg-color: #0d1117;
        --card-bg: #161b22;
        --text-primary: #c9d1d9;
        --text-secondary: #8b949e;
        --border-color: #30363d;
        --header-bg: #161b22;
        --hover-bg: #161b22;
        --item-hover-bg: #1f2428;
        --btn-bg: #21262d;
        --btn-border: #363b42;
        --btn-hover-bg: #30363d;
        --code-bg: #0d1117;
        --back-item-bg: #1c1e23;
        --separator-color: #484f58;
        --shadow-color: rgba(0,0,0,0.3);
      }
      .markdown-body {
        color: var(--text-primary) !important;
        background-color: transparent !important;
      }
      .markdown-body a { color: var(--primary-color) !important; }
      .markdown-body pre, .markdown-body code { background-color: var(--code-bg) !important; }
      iframe { background-color: #fff; }
    }

    /* =========================================
       å¸ƒå±€æ ·å¼
       ========================================= */
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-primary);
      margin: 0; padding: 0;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh;
      transition: background-color 0.3s, color 0.3s;
    }

    .page-header { margin-top: 40px; margin-bottom: 20px; text-align: center; }
    .page-title { font-size: 32px; font-weight: 300; color: var(--text-primary); margin: 0; }

    .container {
      width: 90%; max-width: 980px;
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      box-shadow: 0 1px 3px var(--shadow-color);
      display: flex; flex-direction: column;
      min-height: 500px; margin-bottom: 20px;
    }

    /* é¡¶éƒ¨å·¥å…·æ  */
    .header {
      padding: 12px 16px;
      background: var(--header-bg);
      border-bottom: 1px solid var(--border-color);
      display: flex; align-items: center; justify-content: space-between;
      gap: 15px;
      border-top-left-radius: 6px; border-top-right-radius: 6px;
    }

    .breadcrumb-container {
      font-size: 14px; font-weight: 600; color: var(--text-secondary);
      flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis;
    }
    .breadcrumb-item { cursor: pointer; color: var(--primary-color); }
    .breadcrumb-item:hover { text-decoration: underline; }
    .breadcrumb-separator { margin: 0 5px; color: var(--separator-color); }

    .search-wrapper { position: relative; width: 250px; }
    .search-input {
      width: 100%; padding: 6px 12px;
      border: 1px solid var(--border-color);
      background-color: var(--bg-color);
      color: var(--text-primary);
      border-radius: 6px; font-size: 14px; outline: none; box-sizing: border-box;
    }
    .search-input:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(3, 102, 214, 0.3); }

    /* æ–‡ä»¶åˆ—è¡¨ */
    .file-list { list-style: none; margin: 0; padding: 0; }
    .file-item {
      display: flex; align-items: center; padding: 10px 16px;
      border-bottom: 1px solid var(--border-color); cursor: pointer;
      transition: background 0.1s;
    }
    .file-item:last-child { border-bottom: none; }
    .file-item:hover { background-color: var(--item-hover-bg); }
    
    .icon { margin-right: 12px; width: 20px; text-align: center; flex-shrink: 0; }
    .file-info { display: flex; flex-direction: column; flex: 1; overflow: hidden; }
    .file-name { color: var(--primary-color); font-weight: 500; }
    .file-path { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }
    .file-item:hover .file-name { text-decoration: underline; }
    .back-item { background-color: var(--back-item-bg); }

    /* README */
    .readme-container { padding: 32px; border-top: 1px solid var(--border-color); }
    .readme-title {
      font-size: 12px; color: var(--text-secondary); text-transform: uppercase;
      font-weight: 600; margin-bottom: 10px; padding-bottom: 10px;
      border-bottom: 1px solid var(--border-color);
    }

    /* é¢„è§ˆè§†å›¾ */
    .preview-header-bar { display: flex; justify-content: space-between; align-items: center; width: 100%; }
    
    .btn {
      padding: 6px 12px;
      border: 1px solid var(--border-color);
      background: var(--btn-bg);
      color: var(--text-primary);
      border-radius: 4px; cursor: pointer; font-size: 14px;
      text-decoration: none; display: inline-block; transition: 0.2s;
    }
    .btn:hover { background-color: var(--btn-hover-bg); border-color: var(--text-secondary); }
    
    .btn-primary { background-color: #2ea44f; color: white; border: 1px solid rgba(27,31,35,.15); }
    .btn-primary:hover { background-color: #2c974b; border-color: rgba(27,31,35,.15); }
    
    .preview-body { padding: 20px; flex: 1; display: flex; flex-direction: column; min-height: 400px; }
    .preview-image { max-width: 100%; display: block; margin: 0 auto; }
    .preview-code {
      background: var(--code-bg); color: var(--text-primary);
      padding: 15px; border-radius: 4px; overflow-x: auto;
      border: 1px solid var(--border-color);
    }
    .pdf-frame { width: 100%; height: 80vh; border: 1px solid var(--border-color); border-radius: 4px; }

    .page-footer { margin-top: auto; padding: 20px; color: var(--text-secondary); font-size: 12px; text-align: center; }
    .hidden { display: none !important; }

    @media (max-width: 600px) {
      .container { width: 100%; border-left: none; border-right: none; border-radius: 0; }
      .search-wrapper { width: 140px; }
    }
  </style>
</head>
<body>

<header class="page-header">
  <h1 class="page-title">ustCShame</h1>
</header>

<div class="container">
  
  <!-- åˆ—è¡¨è§†å›¾ -->
  <div id="view-list">
    <div class="header">
      <div class="breadcrumb-container" id="breadcrumb">
        <span>/</span>
      </div>
      <div class="search-wrapper">
        <input type="text" id="searchInput" class="search-input" placeholder="æœç´¢..." autocomplete="off">
      </div>
    </div>

    <div class="file-list" id="fileList">
      <div style="padding: 20px; text-align: center; color: var(--text-secondary);">åŠ è½½ä¸­...</div>
    </div>

    <div id="readmeBox" class="readme-container hidden">
      <div class="readme-title">README.md</div>
      <div id="readmeFooter" class="markdown-body"></div>
    </div>
  </div>

  <!-- é¢„è§ˆè§†å›¾ -->
  <div id="view-preview" class="hidden">
    <div class="header">
      <div class="preview-header-bar">
        <button class="btn" onclick="closePreview()">â¬… è¿”å›</button>
        <span id="previewTitle" style="font-weight: bold; margin: 0 10px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">File</span>
        <a id="downloadBtn" class="btn btn-primary" href="#" target="_blank">â¬‡ ä¸‹è½½</a>
      </div>
    </div>
    <div id="previewContent" class="preview-body markdown-body"></div>
  </div>

</div>

<footer class="page-footer">
  <p>&copy; <script>document.write(new Date().getFullYear());</script> ustCShame. All rights reserved.</p>
  <p>ä»…ä¾›å­¦ä¹ äº¤æµä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºå•†ä¸šç”¨é€”</p>
</footer>

<script>
  let rootTree = [];
  let pathStack = []; 
  // æˆ‘ä»¬ä¸å†éœ€è¦å•ç‹¬çš„ isSearching å˜é‡ï¼Œå› ä¸º Hash å†³å®šäº†çŠ¶æ€

  async function init() {
    try {
      const res = await fetch('tree.json');
      rootTree = await res.json();
      
      // 1. ç›‘å¬ Hash å˜åŒ–ï¼ˆè·¯ç”±æ ¸å¿ƒï¼‰
      window.addEventListener('hashchange', () => syncStateFromHash());

      // 2. æœç´¢æ¡†è¾“å…¥ï¼šæ›´æ–° Hashï¼Œä¸ç›´æ¥æ¸²æŸ“ï¼ˆè®© hashchange å¤„ç†ï¼‰
      document.getElementById('searchInput').addEventListener('input', (e) => {
        const keyword = e.target.value.trim();
        if (keyword) {
          // ä½¿ç”¨ replaceState é¿å…æ¯è¾“å…¥ä¸€ä¸ªå­—æ¯å°±äº§ç”Ÿä¸€æ¡å†å²è®°å½•
          // ä½†ä¿æŒ hash ç»“æ„è®©ç”¨æˆ·å¯ä»¥éšæ—¶å¤åˆ¶
          window.history.replaceState(null, null, '#search=' + encodeURIComponent(keyword));
          // æ‰‹åŠ¨è°ƒç”¨åŒæ­¥ï¼Œå› ä¸º replaceState ä¸è§¦å‘ hashchange
          syncStateFromHash(); 
        } else {
          // æœç´¢æ¸…ç©ºï¼Œå›åˆ°æ ¹ç›®å½•æˆ–ä¿æŒåœ¨å½“å‰ç›®å½•ï¼Ÿè¿™é‡Œé€»è¾‘è®¾ä¸ºå›åˆ°æ ¹ç›®å½•åˆ—è¡¨
          window.location.hash = '';
        }
      });

      // 3. é¦–æ¬¡åŠ è½½
      syncStateFromHash();

    } catch (e) {
      document.getElementById('fileList').innerHTML = `<div style="padding:20px; color:red;">æ— æ³•åŠ è½½ tree.json</div>`;
      console.error(e);
    }
  }

  // === æ ¸å¿ƒè·¯ç”±é€»è¾‘ ===
  function syncStateFromHash() {
    let hash = decodeURIComponent(window.location.hash.slice(1));
    
    // A. å¤„ç†æœç´¢çŠ¶æ€
    if (hash.startsWith('search=')) {
      const keyword = hash.substring(7); // å»æ‰ 'search='
      // æ¢å¤è¾“å…¥æ¡†å†…å®¹ï¼ˆå¦‚æœæ˜¯åˆ·æ–°é¡µé¢è¿›æ¥çš„ï¼‰
      const input = document.getElementById('searchInput');
      if (input.value !== keyword) input.value = keyword;
      
      performSearchUI(keyword);
      return;
    }

    // B. å¤„ç†å¸¸è§„è·¯å¾„ï¼ˆæ–‡ä»¶å¤¹æˆ–æ–‡ä»¶ï¼‰
    document.getElementById('searchInput').value = ''; // æ¸…ç©ºæœç´¢æ¡†
    
    if (!hash) {
      // æ ¹ç›®å½•
      pathStack = [];
      exitPreviewUI();
      renderListUI();
      return;
    }

    const parts = hash.split('/').filter(p => p);
    let currentNodes = rootTree;
    let newStack = [];
    let targetNode = null;
    let valid = true;

    // éå†è·¯å¾„å¯»æ‰¾èŠ‚ç‚¹
    for (let i = 0; i < parts.length; i++) {
      const part = parts[i];
      // åœ¨å½“å‰å±‚çº§å¯»æ‰¾åŒ¹é…çš„åç§°
      const found = currentNodes.find(n => n.name === part);
      
      if (!found) {
        valid = false;
        break;
      }

      if (found.type === 'dir') {
        newStack.push(found);
        currentNodes = found.children || [];
      } else {
        // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œåº”è¯¥æ˜¯è·¯å¾„çš„æœ€åä¸€éƒ¨åˆ†
        if (i === parts.length - 1) {
          targetNode = found;
        } else {
          // å¦‚æœè·¯å¾„ä¸­é—´å‡ºç°æ–‡ä»¶ï¼ˆä¾‹å¦‚ folder/file.txt/subï¼‰ï¼Œåˆ™æ˜¯æ— æ•ˆè·¯å¾„
          valid = false; 
        }
      }
    }

    if (!valid) {
      console.warn('Path not found:', hash);
      window.location.hash = '';
      return;
    }

    // æ›´æ–°å…¨å±€çŠ¶æ€
    pathStack = newStack; // å¦‚æœæ˜¯æ–‡ä»¶ï¼Œstack æ˜¯å®ƒæ‰€åœ¨çš„æ–‡ä»¶å¤¹å±‚çº§

    if (targetNode) {
      // === çŠ¶æ€ï¼šé¢„è§ˆæ–‡ä»¶ ===
      // å…ˆæ¸²æŸ“èƒŒæ™¯åˆ—è¡¨ï¼ˆå³çˆ¶æ–‡ä»¶å¤¹å†…å®¹ï¼‰
      renderListUI(); 
      // å†æ‰“å¼€é¢„è§ˆé®ç½©
      // æ„å»ºå®Œæ•´ä¸‹è½½é“¾æ¥
      const fullPath = newStack.map(n => n.name).join('/') + '/' + targetNode.name;
      openPreviewUI(targetNode, fullPath);
    } else {
      // === çŠ¶æ€ï¼šæµè§ˆæ–‡ä»¶å¤¹ ===
      exitPreviewUI();
      renderListUI();
    }
  }

  // === ç”¨æˆ·äº¤äº’è§¦å‘å™¨ (åªä¿®æ”¹ Hash) ===

  function enterFolder(node) {
    const currentPathNames = pathStack.map(n => n.name);
    currentPathNames.push(node.name);
    window.location.hash = currentPathNames.join('/');
  }

  function goBackFolder() {
    // é€»è¾‘ä¸Šæ˜¯å›é€€ä¸€çº§
    const currentHash = decodeURIComponent(window.location.hash.slice(1));
    const parts = currentHash.split('/').filter(p => p);
    if (parts.length > 0) {
      parts.pop();
      window.location.hash = parts.join('/');
    }
  }

  function jumpToBreadcrumb(index) {
    if (index === -1) {
      window.location.hash = '';
    } else {
      const newPath = pathStack.slice(0, index + 1).map(n => n.name).join('/');
      window.location.hash = newPath;
    }
  }

  function clickFile(node) {
    // ç‚¹å‡»æ–‡ä»¶ -> åŒæ ·æ˜¯ä¿®æ”¹ Hashï¼ŒæŠŠæ–‡ä»¶ååŠ åˆ°è·¯å¾„åé¢
    const currentPathNames = pathStack.map(n => n.name);
    currentPathNames.push(node.name);
    window.location.hash = currentPathNames.join('/');
  }

  function clickSearchResultFile(node, fullPath) {
    // æœç´¢ç»“æœç‚¹å‡» -> è®¾ç½® Hash ä¸ºå®Œæ•´è·¯å¾„
    window.location.hash = fullPath;
  }
  
  function clickSearchResultDir(node, parents) {
      const pathNames = [...parents, node].map(n => n.name);
      window.location.hash = pathNames.join('/');
  }

  function closePreview() {
    // å…³é—­é¢„è§ˆ = å›åˆ°å½“å‰æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼ˆå³å»æ‰ Hash ä¸­çš„æ–‡ä»¶åï¼‰
    const currentHash = decodeURIComponent(window.location.hash.slice(1));
    if (currentHash.startsWith('search=')) {
        // å¦‚æœæ˜¯ä»æœç´¢è¿›å…¥çš„é¢„è§ˆï¼Œå…³é—­æ—¶å¯èƒ½æƒ³å›åˆ°æœç´¢ç»“æœ
        // ä½†ç›®å‰ç®€å•å¤„ç†ï¼šæ ¹æ® UI çŠ¶æ€åˆ¤æ–­ã€‚
        // ç”±äº Hash å·²ç»æ˜¯æ–‡ä»¶è·¯å¾„äº†ï¼Œæˆ‘ä»¬è¿™é‡Œç®€å•åœ°å›é€€ä¸€çº§å³å¯
        // æ³¨æ„ï¼šå¦‚æœæ˜¯æœç´¢ç›´æ¥è·³åˆ°æ–‡ä»¶ï¼ŒHash å˜æˆäº†è·¯å¾„ï¼Œä¸å†æ˜¯ search=...
        // è¿™ç§æƒ…å†µä¸‹ï¼Œå…³é—­é¢„è§ˆä¼šå›åˆ°æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œè€Œä¸æ˜¯æœç´¢ç»“æœåˆ—è¡¨ã€‚
        // è¿™æ˜¯æ ‡å‡†çš„æ–‡ä»¶ç³»ç»Ÿè¡Œä¸ºã€‚
        window.history.back();
    } else {
        const parts = currentHash.split('/').filter(p => p);
        if (parts.length > 0) {
            parts.pop();
            window.location.hash = parts.join('/');
        } else {
            window.location.hash = '';
        }
    }
  }

  // === UI æ¸²æŸ“å‡½æ•° (ä¸ç›´æ¥æ“ä½œé€»è¾‘ï¼Œåªç”»å›¾) ===

  function renderListUI() {
    document.getElementById('view-list').classList.remove('hidden');
    document.getElementById('view-preview').classList.add('hidden');
    document.getElementById('breadcrumb').style.visibility = 'visible';
    
    // å¦‚æœ Hash æ˜¯ search=... è¿™ä¸ªå‡½æ•°ä¸ä¼šè¢«è°ƒç”¨ï¼Œæ‰€ä»¥è¿™é‡Œé»˜è®¤æ˜¯éæœç´¢çŠ¶æ€
    const container = document.getElementById('fileList');
    container.innerHTML = '';
    
    const nodes = (pathStack.length === 0) ? rootTree : (pathStack[pathStack.length - 1].children || []);
    const currentBasePath = pathStack.map(n => n.name).join('/') + (pathStack.length ? '/' : '');

    // é¢åŒ…å±‘
    renderBreadcrumbUI();

    // è¿”å›æŒ‰é’®
    if (pathStack.length > 0) {
      const backDiv = document.createElement('div');
      backDiv.className = 'file-item back-item';
      backDiv.innerHTML = `<span class="icon">ğŸ”™</span><div class="file-info"><span class="file-name">.. (è¿”å›ä¸Šä¸€çº§)</span></div>`;
      backDiv.onclick = goBackFolder;
      container.appendChild(backDiv);
    }

    // æ’åº
    const sortedNodes = [...nodes].sort((a, b) => {
      if (a.type === b.type) return a.name.localeCompare(b.name);
      return a.type === 'dir' ? -1 : 1;
    });

    if (sortedNodes.length === 0) {
      container.innerHTML += `<div style="padding:20px; text-align:center; color:var(--text-secondary);">ç©ºç›®å½•</div>`;
    }

    sortedNodes.forEach(node => {
      const el = document.createElement('div');
      el.className = 'file-item';
      const icon = node.type === 'dir' ? 'ğŸ“' : 'ğŸ“„';
      el.innerHTML = `<span class="icon">${icon}</span><div class="file-info"><span class="file-name">${node.name}</span></div>`;

      if (node.type === 'dir') {
        el.onclick = () => enterFolder(node);
      } else {
        el.onclick = () => clickFile(node);
      }
      container.appendChild(el);
    });

    handleReadmeInList(nodes, currentBasePath);
  }

  function performSearchUI(keyword) {
    // åˆ‡æ¢åˆ°åˆ—è¡¨è§†å›¾ï¼Œä½†éšè—é¢åŒ…å±‘å’Œ README
    document.getElementById('view-list').classList.remove('hidden');
    document.getElementById('view-preview').classList.add('hidden');
    document.getElementById('breadcrumb').style.visibility = 'hidden';
    document.getElementById('readmeBox').classList.add('hidden');

    const container = document.getElementById('fileList');
    const lowerKey = keyword.toLowerCase();
    const results = [];

    function traverse(nodes, parentPath, parents) {
      nodes.forEach(node => {
        const fullPath = parentPath + node.name;
        if (node.name.toLowerCase().includes(lowerKey)) {
          results.push({ node, path: fullPath, parents: [...parents] });
        }
        if (node.type === 'dir' && node.children) {
          traverse(node.children, fullPath + '/', [...parents, node]);
        }
      });
    }
    traverse(rootTree, '', []);

    container.innerHTML = '';
    if (results.length === 0) {
      container.innerHTML = `<div style="padding:20px; text-align:center; color:var(--text-secondary);">æ— æœç´¢ç»“æœ</div>`;
      return;
    }

    results.forEach(res => {
      const el = document.createElement('div');
      el.className = 'file-item';
      const icon = res.node.type === 'dir' ? 'ğŸ“' : 'ğŸ“„';
      el.innerHTML = `
        <span class="icon">${icon}</span>
        <div class="file-info">
          <span class="file-name">${res.node.name}</span>
          <span class="file-path">${res.path}</span>
        </div>`;

      if (res.node.type === 'dir') {
        el.onclick = () => clickSearchResultDir(res.node, res.parents);
      } else {
        el.onclick = () => clickSearchResultFile(res.node, res.path);
      }
      container.appendChild(el);
    });
  }

  async function openPreviewUI(node, fullPath) {
    document.getElementById('view-list').classList.add('hidden');
    document.getElementById('view-preview').classList.remove('hidden');
    document.getElementById('previewTitle').textContent = node.name;
    
    // é…ç½®ä¸‹è½½æŒ‰é’®
    const btn = document.getElementById('downloadBtn');
    btn.href = fullPath;
    btn.download = node.name;

    const container = document.getElementById('previewContent');
    container.innerHTML = '<div style="text-align:center; padding: 20px;">æ­£åœ¨åŠ è½½é¢„è§ˆ...</div>';
    
    const ext = node.name.split('.').pop().toLowerCase();
    
    // é¢„è§ˆé€»è¾‘
    if (['png', 'jpg', 'jpeg', 'gif', 'svg', 'webp'].includes(ext)) {
      container.innerHTML = `<img src="${fullPath}" class="preview-image">`;
    } else if (['mp4', 'webm'].includes(ext)) {
      container.innerHTML = `<div style="text-align:center"><video controls style="max-width:100%"><source src="${fullPath}"></video></div>`;
    } else if (ext === 'pdf') {
      container.innerHTML = `<iframe src="${fullPath}" class="pdf-frame" frameborder="0"><p>è¯·ä¸‹è½½æŸ¥çœ‹ã€‚</p></iframe>`;
    } else if (['md', 'markdown'].includes(ext)) {
      try {
        const text = await fetch(fullPath).then(r => r.text());
        container.innerHTML = marked.parse(text);
      } catch (e) { container.innerHTML = 'åŠ è½½å¤±è´¥'; }
    } else if (['txt', 'js', 'json', 'css', 'html', 'py', 'java', 'c', 'cpp', 'h', 'go', 'rs'].includes(ext)) {
      try {
        const text = await fetch(fullPath).then(r => r.text());
        const safeText = text.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;");
        container.innerHTML = `<pre class="preview-code"><code>${safeText}</code></pre>`;
      } catch (e) { container.innerHTML = 'åŠ è½½å¤±è´¥'; }
    } else {
      container.innerHTML = `<div style="text-align:center; margin-top:50px; color:var(--text-secondary);"><p>æ­¤æ–‡ä»¶ä¸æ”¯æŒåœ¨çº¿é¢„è§ˆï¼Œè¯·ä¸‹è½½ã€‚</p></div>`;
    }
  }

  function exitPreviewUI() {
    document.getElementById('view-preview').classList.add('hidden');
    document.getElementById('previewContent').innerHTML = '';
  }

  function renderBreadcrumbUI() {
    const header = document.getElementById('breadcrumb');
    header.innerHTML = '';
    const rootSpan = document.createElement('span');
    rootSpan.textContent = 'ğŸ  Root';
    rootSpan.className = pathStack.length === 0 ? '' : 'breadcrumb-item';
    if(pathStack.length > 0) rootSpan.onclick = () => jumpToBreadcrumb(-1);
    header.appendChild(rootSpan);

    pathStack.forEach((node, index) => {
      const sep = document.createElement('span');
      sep.className = 'breadcrumb-separator';
      sep.textContent = '/';
      header.appendChild(sep);

      const span = document.createElement('span');
      span.textContent = node.name;
      if (index < pathStack.length - 1) {
        span.className = 'breadcrumb-item';
        span.onclick = () => jumpToBreadcrumb(index);
      }
      header.appendChild(span);
    });
  }

  async function handleReadmeInList(nodes, basePath) {
    const readmeNode = nodes.find(n => n.name.toLowerCase() === 'readme.md');
    const readmeBox = document.getElementById('readmeBox');
    const contentDiv = document.getElementById('readmeFooter');
    if (readmeNode) {
      const path = basePath + readmeNode.name;
      try {
        const text = await fetch(path).then(r => r.text());
        contentDiv.innerHTML = marked.parse(text);
        readmeBox.classList.remove('hidden');
      } catch (e) {
        readmeBox.classList.add('hidden');
      }
    } else {
      readmeBox.classList.add('hidden');
      contentDiv.innerHTML = '';
    }
  }

  init();
</script>

</body>
</html>