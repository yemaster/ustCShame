<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äº‘ç›˜æ–‡ä»¶æµè§ˆ</title>
  <!-- å¼•å…¥ Marked ç”¨äºè§£æ Markdown -->
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <!-- å¼•å…¥ GitHub Markdown CSS ç”¨äºç¾åŒ– README -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css/github-markdown.min.css">
  <style>
    :root {
      --primary-color: #0366d6;
      --hover-bg: #f6f8fa;
      --border-color: #e1e4e8;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
      background-color: #f6f8fa;
      color: #24292e;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }

    .container {
      width: 100%;
      max-width: 900px;
      background: white;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* é¡¶éƒ¨è·¯å¾„æ  */
    .header {
      padding: 16px;
      background: #fcfcfc;
      border-bottom: 1px solid var(--border-color);
      font-size: 14px;
      font-weight: 600;
      color: #586069;
    }
    .breadcrumb-item {
      cursor: pointer;
      color: var(--primary-color);
    }
    .breadcrumb-item:hover {
      text-decoration: underline;
    }
    .breadcrumb-separator {
      margin: 0 5px;
      color: #999;
    }

    /* æ–‡ä»¶åˆ—è¡¨ */
    .file-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .file-item {
      display: flex;
      align-items: center;
      padding: 10px 16px;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: background 0.2s;
    }

    .file-item:last-child {
      border-bottom: none;
    }

    .file-item:hover {
      background-color: var(--hover-bg);
    }

    .icon {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    .file-name {
      flex: 1;
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .file-item:hover .file-name {
      text-decoration: underline;
    }

    .back-item {
      background-color: #fff9f9;
      font-weight: bold;
    }

    /* README åŒºåŸŸ */
    .readme-container {
      padding: 32px;
      border-top: 1px solid var(--border-color);
    }
    .readme-title {
      font-size: 12px;
      color: #586069;
      text-transform: uppercase;
      font-weight: 600;
      margin-bottom: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eaecef;
    }
  </style>
</head>
<body>

<div class="container">
  <!-- é¡¶éƒ¨é¢åŒ…å±‘ -->
  <div class="header" id="breadcrumb">
    <span>/</span>
  </div>

  <!-- æ–‡ä»¶åˆ—è¡¨ -->
  <div class="file-list" id="fileList">
    <div style="padding: 20px; text-align: center; color: #666;">åŠ è½½ä¸­...</div>
  </div>

  <!-- README å±•ç¤ºåŒº -->
  <div id="readmeBox" class="readme-container" style="display: none;">
    <div class="readme-title">README.md</div>
    <div id="readmeContent" class="markdown-body"></div>
  </div>
</div>

<script>
  let rootTree = []; // å­˜å‚¨å®Œæ•´çš„æ ‘ç»“æ„
  let pathStack = []; // å­˜å‚¨å½“å‰è·¯å¾„å±‚çº§çš„å¯¹è±¡

  // åˆå§‹åŒ–
  async function init() {
    try {
      const res = await fetch('tree.json');
      rootTree = await res.json();
      render();
    } catch (e) {
      document.getElementById('fileList').innerHTML = `<div style="padding:20px; color:red;">æ— æ³•åŠ è½½ tree.json</div>`;
      console.error(e);
    }
  }

  // è·å–å½“å‰å±‚çº§çš„æ–‡ä»¶åˆ—è¡¨
  function getCurrentNodes() {
    if (pathStack.length === 0) {
      return rootTree;
    }
    // è·å–æ ˆé¡¶ï¼ˆå½“å‰æ–‡ä»¶å¤¹ï¼‰çš„ children
    return pathStack[pathStack.length - 1].children || [];
  }

  // è·å–å½“å‰è·¯å¾„å­—ç¬¦ä¸² (ç”¨äº fetch æ–‡ä»¶)
  function getCurrentPathString() {
    if (pathStack.length === 0) return '';
    return pathStack.map(node => node.name).join('/') + '/';
  }

  // æ¸²æŸ“ä¸»å‡½æ•°
  async function render() {
    const container = document.getElementById('fileList');
    const nodes = getCurrentNodes();
    const currentPathStr = getCurrentPathString();
    
    container.innerHTML = '';

    // 1. æ¸²æŸ“é¢åŒ…å±‘
    renderBreadcrumb();

    // 2. å¦‚æœä¸æ˜¯æ ¹ç›®å½•ï¼Œæ·»åŠ â€œè¿”å›ä¸Šä¸€çº§â€
    if (pathStack.length > 0) {
      const backDiv = document.createElement('div');
      backDiv.className = 'file-item back-item';
      backDiv.innerHTML = `<span class="icon">ğŸ”™</span><span class="file-name">.. (è¿”å›ä¸Šä¸€çº§)</span>`;
      backDiv.onclick = goBack;
      container.appendChild(backDiv);
    }

    // 3. æ’åºï¼šæ–‡ä»¶å¤¹åœ¨å‰ï¼Œæ–‡ä»¶åœ¨å
    const sortedNodes = [...nodes].sort((a, b) => {
      if (a.type === b.type) return a.name.localeCompare(b.name);
      return a.type === 'dir' ? -1 : 1;
    });

    if (sortedNodes.length === 0) {
      container.innerHTML += `<div style="padding:20px; text-align:center; color:#999;">ç©ºæ–‡ä»¶å¤¹</div>`;
    }

    // 4. æ¸²æŸ“åˆ—è¡¨
    sortedNodes.forEach(node => {
      const el = document.createElement('div');
      el.className = 'file-item';
      
      const icon = node.type === 'dir' ? 'ğŸ“' : 'ğŸ“„';
      el.innerHTML = `<span class="icon">${icon}</span><span class="file-name">${node.name}</span>`;

      if (node.type === 'dir') {
        el.onclick = () => enterFolder(node);
      } else {
        el.onclick = () => downloadFile(currentPathStr + node.name);
      }

      container.appendChild(el);
    });

    // 5. å¤„ç† README
    const readmeNode = nodes.find(n => n.name.toLowerCase() === 'readme.md');
    const readmeBox = document.getElementById('readmeBox');
    
    if (readmeNode) {
      const readmePath = currentPathStr + readmeNode.name;
      try {
        const text = await fetch(readmePath).then(r => r.text());
        document.getElementById('readmeContent').innerHTML = marked.parse(text);
        readmeBox.style.display = 'block';
      } catch (e) {
        console.error('Failed to load README', e);
        readmeBox.style.display = 'none';
      }
    } else {
      readmeBox.style.display = 'none';
      document.getElementById('readmeContent').innerHTML = '';
    }
  }

  // æ¸²æŸ“é¢åŒ…å±‘å¯¼èˆª
  function renderBreadcrumb() {
    const header = document.getElementById('breadcrumb');
    header.innerHTML = '';

    // æ ¹ç›®å½•
    const rootSpan = document.createElement('span');
    rootSpan.textContent = 'ğŸ  Root';
    rootSpan.className = pathStack.length === 0 ? '' : 'breadcrumb-item';
    if (pathStack.length > 0) {
      rootSpan.onclick = () => {
        pathStack = [];
        render();
      };
    }
    header.appendChild(rootSpan);

    // è·¯å¾„èŠ‚ç‚¹
    pathStack.forEach((node, index) => {
      const sep = document.createElement('span');
      sep.className = 'breadcrumb-separator';
      sep.textContent = '/';
      header.appendChild(sep);

      const span = document.createElement('span');
      span.textContent = node.name;
      
      // å¦‚æœä¸æ˜¯æœ€åä¸€ä¸ªï¼Œå¯ä»¥ç‚¹å‡»è·³è½¬
      if (index < pathStack.length - 1) {
        span.className = 'breadcrumb-item';
        span.onclick = () => {
          // è·³è½¬åˆ°æŒ‡å®šå±‚çº§
          pathStack = pathStack.slice(0, index + 1);
          render();
        };
      }
      header.appendChild(span);
    });
  }

  // è¿›å…¥æ–‡ä»¶å¤¹
  function enterFolder(node) {
    pathStack.push(node);
    render();
  }

  // è¿”å›ä¸Šä¸€çº§
  function goBack() {
    pathStack.pop();
    render();
  }

  // ä¸‹è½½/æ‰“å¼€æ–‡ä»¶
  function downloadFile(path) {
    // åˆ›å»ºä¸€ä¸ªä¸´æ—¶é“¾æ¥è¿›è¡Œä¸‹è½½/æ‰“å¼€
    const link = document.createElement('a');
    link.href = path;
    link.target = '_blank';
    link.click();
  }

  init();
</script>

</body>
</html>